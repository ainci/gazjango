{% extends "base.html" %}
{% load story_extras %}

{% block title %}{{ story.headline|removetags:"em strong b i" }}{% endblock title %}


{% block customheader %}

<link rel="stylesheet" href="/css/page/story.css" type="text/css" media="screen, projection" />

<script>

function toggleLayer( whichLayer )
{
  var elem, vis;
  if (document.getElementById) // this is the way the standards work
    elem = document.getElementById(whichLayer);
  else if (document.all) // this is the way old msie versions work
      elem = document.all[whichLayer];
  else if (document.layers) // this is the way nn4 works
    elem = document.layers[whichLayer];
  vis = elem.style;
  // if the style.display value is blank we try to figure it out here
  if (vis.display=='' && elem.offsetWidth!=undefined && elem.offsetHeight != undefined)
    vis.display = (elem.offsetWidth != 0 && elem.offsetHeight != 0 ) ? 'block' : 'none';
  vis.display = (vis.display=='' || vis.display=='block') ? 'none' : 'block';
}

</script>

{% endblock customheader %}


{% block topbar %}
  <div id="headerSectionBar">
    <div id="headerSection">
      <h3>
        {% for cat in story.category.ancestors %}
          {% if not forloop.first %} >> {% endif %}
          <a href="{{ cat.get_absolute_url }}">{{ cat.name }}</a>
				{% endfor %}
			</h3>
		</div>
		
		<div id="headerSearch" class="floatRight">
		  <form method="get" id="searchform" action="{% url search %}">
		    Search: 
		    <input type="text" class="textbox" value="" name="s" id="s" />
		    <input type="submit" id="searchsubmit" value="Go" />
		  </form>
		</div>
	</div>
{% endblock topbar %}

	
{% block content %}
	<div id="commentColumn">
		<div id="commentBox">
		  {% include "stories/sidebar.html" %}
		</div>
	</div>
		
	<div id="storyBox">
		<div id="story">
			<h2>{{ story.headline|safe }}</h2>
			<p class="byline">
			  <span class="author">by {{ story.authors|join_authors:"l" }}</span>
			  <span class="date">| 
			    <a href="{{ story.pub_date|issue_url }}">{{ story.pub_date|date:"F j, Y" }}</a>
			  </span>
			</p>
				
			{{ story.resolved_text|safe }}
		</div>
				
		<div id="shareBox">
			<div class="right">
			  <strong>Share:</strong> {% add_this hover %}
			</div>
			<p>
			  <a href="{% url print story %}"><img src="/images/icons/print.png" /> Print</a>
			  &nbsp;&nbsp;
			  <a href="{% url email story %}"><img src="/images/icons/email.png" /> Email</a>
			</p>
		</div>
				
		<div id="continueBox">
			<div id="top">
				<a href="{{ topstory.get_absolute_url }}">
				  <img src="{{ topstory.thumbnail.get_absolute_url }}" />
				</a>
				<div class="content">
				  <h4><a href="{{ topstory.get_absolute_url }}">{{ topstory.get_title }}</a></h4> 
				  <p>{{ topstory.short_summary }}</p>
				</div>
			</div>
      
			<div id="more">
				<div class="box">
					<h4>Related Stories</h4>
					<ul>
						{% for rel in related %}
						  <li><a href="{{rel.get_absolute_url}}">{{ rel.get_title|safe }}</a></li>
						{% endfor %}
					</ul>
				</div>
				<div class="box">
					<h4>Recent Comments</h4>
					<ul>
						{% for comment in comments|slice:":2" %}
							<li><a href="{{comment.get_absolute_url}}">{{ comment.article.get_title }}</a></li>
						{% endfor %}
					</ul>
				</div>			
			</div>
		</div>
		
		<div id="bottomComments">
			<div id="submitComment">
			  <h4 name="submitComment" style="display: none;">Submit a Comment</h4>
			  <form method="post" action="comment/">
          <table>
            {% if user.is_authenticated %}
              <tr>
                <td>
                  {{ comment_form.anonymous.label_tag }}
                  {{ comment_form.anonymous }}
                </td>
                <td>{{ comment_form.name.label_tag }}:</td>
                <td>{{ comment_form.name }}</td>
              </tr>
            {% else %}
              <tr>
                <td>{{ comment_form.name.label_tag }}:</td>
                <td>{{ comment_form.name }}</td>
                <td><a href="{% url login %}">Log in</a> to verify your identity.</td>
              </tr>
              <tr>
                <td>{{ comment_form.email.label_tag }}:</td>
                <td>{{ comment_form.email }}</td>
                <td>Required, but will not be made public.</td>
              </tr>
            {% endif %}
            <tr><td colspan="3">{{ comment_form.text }}</td></tr>
            <tr>
              <td></td>
              <td></td>
              <td>
                <span style="float: right">
                  <input type="submit" name="submit" value="Submit" />
                  <input type="reset"  name="reset"  value="Cancel" />
                </span>
              </td>
            </tr>
          </table>
			  </form>
			</div>
			
			<div id="commentRules">
			  <p>Comments posted anonymously must be approved by Gazette staff before they are published.</p>
  			  
			  <hr width="50%" color="#dddddd" size="1px">
			  
  			<h4>Discussion Rules</h4>
				<ul>
					<li>Be nice.</li>
					<li>Be constructive.</li>
					<li>Don't curse.</li>
					<li>Don't threaten.</li>
				</ul>
					
				<p>More details on our policies <a href="{{ site.links.policy.get_absolute_url }}">here</a>.</p>
				
				<hr width="50%" color="#dddddd" size="1px" /> 
									
				<p>
				  {% if user.is_authenticated %} 
				    <a href="{{ user.manage_url }}">Manage your Account</a>
				  {% else %}
				    <a href="{{ user.register_url }}">Register an Account</a> |
				    <a href="{{ user.login_url }}">Login</a>
				  {% endif %}
				</p>
			</div>
		</div>
	</div>

{% endblock content %}
