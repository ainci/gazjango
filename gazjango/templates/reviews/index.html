{% extends "base.html" %}
{% load extras %}

{% block title %}Community Guide{% endblock title %}

{% block customheader %}
  <link rel="stylesheet" href="{% static css page/section.css %}" type="text/css"/>
  <link rel="stylesheet" href="{% static css page/reviews.css %}" type="text/css"/>
  
  <script type="text/javascript" src="{% static js tablesort.js %}"></script>
  <script type="text/javascript" src="{% static js jquery.jmap-r64.js %}"></script>
  <script src="http://maps.google.com/maps?file=api&amp;v=2&amp;key=ABQIAAAAjWbJvs7_o1h7mvy1LX4wLhTVpvTYn37WYB_LpRxavHaUmFYqkhTotBjskotcwty-WMO0y20agHONnw" type="text/javascript"></script>
  
 
  <script type="text/javascript">
      //<![CDATA[
      function load() {
        if (GBrowserIsCompatible()) {
          var map = new GMap2(document.getElementById("map"));
          map.setCenter(new GLatLng(39.9034, -75.3529), 13);
          map.setMapType(G_HYBRID_MAP);
          
          // Add establishment markers to the map
          var bounds = map.getBounds();
          var southWest = bounds.getSouthWest();
          var northEast = bounds.getNorthEast();
          var lngSpan = northEast.lng() - southWest.lng();
          var latSpan = northEast.lat() - southWest.lat();
          
          {% for establishment in establishments %}
              var point = new GLatLng(establishment.latitude,establishment.longitude);
              var marker = new GMarker(point);
              map.addOverlay(marker);
              GEvent.addListener(marker,'click', function() {
                marker.openInfoWindow('{{ establishment.get_establishment_type_display }}: <strong><a href="#{{ establishment.name }}">{{ establishment.name }}</a></strong>', { maxWidth: 200});
              });
          {% endfor %}
          
          
          jQuery(document).ready(function(){

          	var streetMapCenter = [39.9034,-75.3529];

          	jQuery('.add-streetview').click(function(){
          		jQuery('#map').jmap('CreateStreetviewPanorama', {
          			'latlng':streetMapCenter
          		}, function (view, options){
          			jQuery('.remove-streetview').click(function(){
          				jQuery('#map').jmap('RemoveStreetviewPanorama', view);
          				jQuery('#map').jmap('init', {'mapType':'hybrid','mapCenter': streetMapCenter});
          				return false;
          			});
          		});
          		return false;
          	});
          });
          
          
          
        }
      }
      //]]>
  </script>
  
  
  
{% endblock customheader %}


{% block topbar %}
  <div id="headerSectionBar">
    <div id="headerSearch">
      {% include "search_header.html" %}
    </div>
  </div>
{% endblock topbar %}


{% block content %}
<div id="reviews">
  <h2>A Community Guide</h2>
  <div id="topBlock">
    <div id="sideBar">
            
    </div>
    <div id="mapBlock">
      <div id="map" class="jmap"></div>
    </div>
  </div>

  <div id="listings">
    <table id="review-listings" cellpadding="0" cellspacing="0" border="0" class="sortable-onload-5-6r rowstyle-alt colstyle-alt no-arrow">
      <caption>Reviews from the Swarthmore Area</caption>
      <thead>
        <tr>
          <th class="sortable">Type</th>
          <th class="sortable">Name</th>
          <th class="sortable">Rating</th>
          <th class="sortable">Cost</th>
          <th class="sortable">City</th>
          <th class="sortable">Access</th>
          <th class="sortable">Tags</th>
          <th class="sortable">Reviews</th>
          <th>Notes</th>
        </tr>
      </thead>
      <tbody>
        {% for establishment in establishments %}
          <tr>
            <td>{{ establishment.get_establishment_type_display }}</td>
            <td><a href="{{ establishment.get_absolute_url }}">{{ establishment.name }}</a></td>
            <td>{{ establishment.avg_rating }}</td>
            <td>{{ establishment.avg_cost }}</td>
            <td>{{ establishment.city }}</td>
            <td>{{ establishment.get_access_display }}</td>
            <td>{{ establishment.tag_names }}</td>
            <td>
              {% for review in establishment.reviews.all %}
                <a href="{{ establishment.get_absolute_url }}#{{ review.slug }}">{{ review.reviewer }}</a>
                <br />
              {% endfor %}
            </td>
            <td>{{ establishment.other_info }}</td>
          </tr>
        {% endfor %}
      </tbody>
    </table>
  </div>
</div>
{% endblock content %}
