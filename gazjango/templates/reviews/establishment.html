{% extends "base.html" %}
{% load extras %}

{% block title %}Community Guide{% endblock title %}

{% block customheader %}
  <link rel="stylesheet" href="{% static css page/section.css %}" type="text/css"/>
  <link rel="stylesheet" href="{% static css page/establishment.css %}" type="text/css"/>
  
  <script src="http://maps.google.com/maps?file=api&amp;v=2&amp;key=ABQIAAAAG8P9j9QQO2vTUNEZdr-SshRLWsA0A4EVy0DFjwCAooQph_S49xRweBxq-VXWfeMAOnB19OX6LVP9Ww" type="text/javascript"></script>
  
  {% jQuery %}
  
  <script type="text/javascript">
    var map;
    var directionsPanel;
    var directions;
    var travelMode;
    
    function createMarker(point, text, icon) {
		  var marker = new GMarker(point, icon);
		  // Show this marker's index in the info window when it is clicked
		  GEvent.addListener(marker, "click", function() {
			  marker.openInfoWindowHtml(text);
		  });
		  return marker;
	}
  
    function initialize() {
        
        map = new GMap2(document.getElementById("map"));
        map.setCenter(new GLatLng(39.9034, -75.3529), 15);
        map.addControl(new GMapTypeControl());
        map.addControl(new GLargeMapControl());
        {% ifequal establishment.access "p" %}

        {% endifequal %}
        
        {% ifequal establishment.access "w" %}
            directionsPanel = document.getElementById("route");
            directions = new GDirections(map, directionsPanel);
            directions.load("from: 500 College Ave, Swarthmore PA to: {{ establishment.street_address }}, {{ establishment.city }}",{travelMode:G_TRAVEL_MODE_WALKING});
        {% else %}
            {% ifequal establishment.access "p" %}
                {% ifequal establishment.city "Philadelphia" %}
                    directions.load("from: Philadelphia 30th Street Station, Philadelphia, PA 19104 to: {{ establishment.street_address }}, {{ establishment.city }}",{travelMode:G_TRAVEL_MODE_WALKING});
                {% else %}
                    directions.load("from: 500 College Ave, Swarthmore PA to: {{ establishment.street_address }}, {{ establishment.city }}",{travelMode:G_TRAVEL_MODE_DRIVING});
                {% endifequal %}
            {% else %}
                directions.load("from: 500 College Ave, Swarthmore PA to: {{ establishment.street_address }}, {{ establishment.city }}",{travelMode:G_TRAVEL_MODE_DRIVING});
            {% endifequal %}
        {% endifequal %}
    }
  </script>

{% endblock customheader %}

{% block body-args %}onload="initialize()"{% endblock %}

{% block topbar %}
  <div id="headerSectionBar">
    <div id="headerSearch">
      {% include "search_header.html" %}
    </div>
  </div>
{% endblock topbar %}


{% block content %}
<div id="reviews">
  <h2>{{ establishment.name }}, in the Gazette's Zagette</h2>
  <div id="topBlock">
      <div id="reviewInfo">
          <p><strong>Average Rating:</strong> {{ establishment.avg_rating|default_if_none:"No Ratings" }} | <strong>Average Cost:</strong> {{ establishment.avg_cost|default_if_none:"Unknown" }} | <strong>Tags:</strong> {% for tag in establishment.tags.all %}{{ tag.name }}{% if not forloop.last %}, {% endif %}{% endfor %} | <strong>Phone:</strong> {{ establishment.phone }} | <strong>Address:</strong> {{ establishment.street_address }}, {{ establishment.city }}</p>
      </div>

    <div id="mapBlock">
      <div id="route">
        <!-- Directions inserted here -->
      </div>
      <div id="map" class="jmap">
        
        <!-- Map inserted here -->
        
      </div>
      <div id="reviewText">
          {% for review in establishment.reviews.all %}
            {% if not forloop.first %}<center><hr width="50%" /></center>{% endif %}
            <p><strong>Reviewed by: {{ review.reviewer.name }}</strong> (Cost: {{ review.cost }} Rating: {{ review.rating }})</p>
            <p>{{ review.review_text }}</p>
          {% endfor %}
      </div>
    </div>
  </div>
</div>
{% endblock content %}